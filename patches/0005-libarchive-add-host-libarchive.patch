From 87a8f7b7f72a7da585e45aed064ed520ace1ad7f Mon Sep 17 00:00:00 2001
From: Frank Hunleth <fhunleth@troodon-software.com>
Date: Mon, 2 Jun 2014 18:11:44 -0400
Subject: [PATCH] libarchive: add host-libarchive

This pulls in the libarchive updates from upstream buildroot. It
includes host-libarchive and a version bump.
---
 package/libarchive/libarchive.hash |  2 +-
 package/libarchive/libarchive.mk   | 20 +++++++++++++++++++-
 2 files changed, 20 insertions(+), 2 deletions(-)

diff --git a/package/libarchive/libarchive.hash b/package/libarchive/libarchive.hash
index 5f96211..2c39bd3 100644
--- a/package/libarchive/libarchive.hash
+++ b/package/libarchive/libarchive.hash
@@ -1,2 +1,2 @@
 # Locally computed:
-sha256  eb87eacd8fe49e8d90c8fdc189813023ccc319c5e752b01fb6ad0cc7b2c53d5e  libarchive-3.1.2.tar.gz
+sha256  72ee1a4e3fd534525f13a0ba1aa7b05b203d186e0c6072a8a4738649d0b3cfd2  libarchive-3.2.1.tar.gz
diff --git a/package/libarchive/libarchive.mk b/package/libarchive/libarchive.mk
index 726142b..a264840 100644
--- a/package/libarchive/libarchive.mk
+++ b/package/libarchive/libarchive.mk
@@ -4,7 +4,7 @@
 #
 ################################################################################
 
-LIBARCHIVE_VERSION = 3.1.2
+LIBARCHIVE_VERSION = 3.2.1
 LIBARCHIVE_SITE = http://www.libarchive.org/downloads
 LIBARCHIVE_INSTALL_STAGING = YES
 LIBARCHIVE_LICENSE = BSD-2c, BSD-3c
@@ -99,4 +99,22 @@ else
 LIBARCHIVE_CONF_OPTS += --without-lzma
 endif
 
+# The only user of host-libarchive needs zlib support
+HOST_LIBARCHIVE_DEPENDENCIES = host-zlib
+HOST_LIBARCHIVE_CONF_OPTS = \
+	--disable-bsdtar \
+	--disable-bsdcpio \
+	--disable-acl \
+	--disable-xattr \
+	--without-bz2lib \
+	--without-expat \
+	--without-libiconv-prefix \
+	--without-xml2 \
+	--without-lzo2 \
+	--without-nettle \
+	--without-openssl \
+	--without-lz4 \
+	--without-lzma
+
 $(eval $(autotools-package))
+$(eval $(host-autotools-package))
-- 
2.7.4

